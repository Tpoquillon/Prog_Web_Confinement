{% extends 'base.html' %}
{% block content %}
<h1 class="">Building API endpoints</h1>
  <!--
  <article id="intro" class="to_hide">
    <div><hr /></div>
    <h2 class="nocount">Get the sources</h2>
      <div class="alert alert-primary" role="alert">
        <h4 class="nocount"><a href="https://forge.p2chpd.univ-lyon1.fr/geoffroy.berret/PrograWebSources" class="font-weight-bold">https://forge.p2chpd.univ-lyon1.fr/geoffroy.berret/PrograWebSources</a></h4>
        <code class="font-weight-bold">git clone https://forge.p2chpd.univ-lyon1.fr/geoffroy.berret/PrograWebSources.git</code>
      </div>
    <h2 class=nocount>Then setup the environment</h2>
      <p>Open a terminal an run the following commands:<br />
      <pre class="text-monospace"><code>cd Découverte_Flask && ./do
./do serve</code></pre>
    <input class="btn btn-primary" id="hideIntro" type="button" value="hide" />
  </article>
  -->
  <hr />

  <article id="intro" class="to_hide">
  <h2 class="nocount">JSON API</h2>
  <div class="alert alert-primary" role="alert">
    <p class="lead">The API will serve representation in JSON by default.</p>
    <p>To do so, use high level helper in Flask such as</p>
    <ul>
      <li><a href="https://flask.palletsprojects.com/en/1.1.x/api/#flask.json.jsonify"><code>flask.json.jsonify(*args, **kwargs)</code></a>.</li>
      <li><a href="https://flask.palletsprojects.com/en/1.1.x/api/#flask.json.dumps"><code>flask.json.dumps(*args, **kwargs)</code></a>.</li>
    </ul>
    <p class="lead">The API is defined within <code>./api.py</code> and exposed
    in the Flask app through <a href="http://flask.pocoo.org/docs/1.0/blueprints/#blueprints">blueprints</a> in <code>./app.py</code>.</p>
    <p>All API resources are exposed under <code>/api/</code> path (cf. <code>./app.py</code>).</p>

    <p>The API should follow as much as possible the REST principles.</p>
  <input class="btn btn-primary" id="hideIntro" type="button" value="hide" />
  </div>
  </article>

  <article>
    <h2>Add end point to list users</h2>
    <p>Add an <code><a href="api/users/">api/users</a></code> end point listing all users in a json list.</p>
    <p><a href="#listusers" data-toggle="collapse">show</a> expected output using curl:</p>
    <div class="solblock">
      <pre class="preshow"><code class="bash">curl -i http://localhost:8000/api/users/</code></pre>
      <pre class="solution collapse" id="listusers">HTTP/1.1 200 OK
Server: Werkzeug/0.16.0 Python/3.7.3
Date: Fri, 10 Jan 2020 16:08:58 GMT
Content-Type: application/json                    &lt;----- Answer announces the right Mime Type,
Content-Length: 120                                      as given in the body below ↓

["Alan Turing","Katherine Johnson", "John…        &lt;------ The actual body in json</pre>
</div>
    <h2>Add end point to expose single user resource</h2>
    <p>Expose all information for a user. For instance for user "Alan Turing": <a href="/api/users/Alan Turing">/api/users/Alan Turing</a>.</p>
    <p><a href="#listsingleuser" data-toggle="collapse">show</a> expected output using curl:</p>
    <div class="solblock">
      <pre class="preshow" id="aaa"><code class="bash">curl -i http://localhost:8000/api/users/Alan%20Turing</code></pre>
      <pre class="solution collapse" id="listsingleuser">HTTP/1.1 200 OK
Server: Werkzeug/0.16.0 Python/3.7.3
Date: Fri, 10 Jan 2020 16:08:58 GMT
Content-Type: application/json
Content-Length: 120

{"name":"Alan Turing",
 "birth":"1912-6-23T00:00:00.000Z",
 "fields":["mathematics","computer science","logic"],
 "gender":"m", "id":0,
 "wikipageid":"1208"}</pre>
    </div>
    <h3>Alternative representation [Optional]</h3>
    <p>Allow at least an alternative representation (for instance <strong>plain text</strong> instead of json).</p>
    <p>To achieve it, use MIME type for Accept/Content-Type headers directive as you did with the hello_world exercise (cf. <a href="https://developer.mozilla.org/fr/docs/Web/HTTP/Basics_of_HTTP/MIME_types">MIME_types</a> if needed).</p>

    <h2>Filter the user list</h2>
    <p>Use the query string of the GET request to filter users list on a specific field (no multi-field filtering).</p>
    <p>Start with a filter on gender, then add support for name as well.</p>
    <p>The resource should be something like: <a href="/api/users/?field=value">/api/users/?field=value</a>.</p>
    <p><a href="#filterfield" data-toggle="collapse">show</a> expected output using curl:</p>
    <div class="solblock">
      <pre class="preshow"><code class="bash">curl -i http://localhost:8000/api/users/?gender=f</code></pre>
      <pre class="solution collapse" id="filterfield">HTTP/1.1 200 OK
Server: Werkzeug/0.16.0 Python/3.7.3
Date: Fri, 10 Jan 2020 16:08:58 GMT
Content-Type: application/json
Content-Length: 120

["Katherine Johnson","Grace Hopper"]</pre>
</div>

    <h2>Set user end point to accept resource modification</h2>
    <p>Allow modification of user information. The payload would be a subset  of a user information (in json).</p>
    <p>For instance modify user name, from "John Neumann" to "John Von Neumann".<br />
    JSON Payload example: " <code>{ "name": "John Von Neumann" }</code> "</p>

    <p><a href="#chneumann" data-toggle="collapse">show</a> expected output using curl:</p>
    <div class="solblock">
      <pre class="preshow" id="aaa"><code class="bash">curl -id '{ "name": "John Von Neumann" }' -H "Content-Type: application/json" -X PUT  http://127.0.0.1:8000/api/users/2</code></pre>
      <pre class="solution collapse" id="chneumann">HTTP/1.0 200 OK
Content-Type: text/html; charset=utf-8
Content-Length: 4
Server: Werkzeug/0.16.0 Python/3.7.3
Date: Wed, 29 Jan 2020 17:26:41 GMT

Done
</pre>
    </div>

    <p>Then check in the <a href="{{ url_for('users') }}">user list</a> if your modification is there ! Or simply fetch it with curl.</p>

    <h2>Add new user</h2>
    <p>Use a JSON payload, only add 'name', 'birth' and 'gender' keys.</p>
    <p>Payload example: " <code>{ "name": "Joan Clarke", "birth": "1917-06-24T00:00:00.000Z", "gender": "f" }</code> ".</p>
    <p>Use <code>curl</code> the same way you did for the previous exercise but with a different json payload.</p>

  </article>
{% endblock %}
{% block script %}
    <script>document.getElementById('hideIntro').onclick = function() { document.getElementById('intro').setAttribute('hidden', '') };</script>
{% endblock %}

<!-- vim: set filetype=html spell spelllang=en: -->
